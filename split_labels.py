import os
import numpy as np
from multiprocessing import Pool
from csv import writer

import pandas as pd

BASE_DIR = "/media/xueshan/WD_BLACK/cybersecurity/malaware"
# BASE_DIR = "/home/xueshan/temp/malaware"
TRAIN_DIR = os.path.join(BASE_DIR, "train")
TEST_DIR = os.path.join(BASE_DIR, "test")

DATA_OUT_DIR = os.path.join(BASE_DIR, "data_out")


def split_labels():
    author_file = os.path.join(BASE_DIR, "trainLabels.csv")
    adf: pd.DataFrame = pd.read_csv(author_file)
    adf.set_index("Id", inplace=True)
    df: pd.DataFrame = None

    # train
    train_ids = []
    for train_asm_file in [f for f in os.listdir(TRAIN_DIR) if f.endswith(".asm")]:
        id = train_asm_file.replace(".asm", "")
        train_ids.append(id)

    train_df:pd.DataFrame = adf.loc[train_ids]
    train_df.sort_index(inplace=True)
    print(train_df)
    train_df.to_csv(os.path.join(DATA_OUT_DIR, "train-labels.csv"))

    # test
    test_ids = []
    for test_asm_file in [f for f in os.listdir(TEST_DIR) if f.endswith(".asm")]:
        id = test_asm_file.replace(".asm", "")
        test_ids.append(id)

    test_df:pd.DataFrame = adf.loc[test_ids]
    test_df.sort_index(inplace=True)
    print(test_df)
    test_df.to_csv(os.path.join(DATA_OUT_DIR, "test-labels.csv"))


if __name__ == '__main__':
    split_labels()
